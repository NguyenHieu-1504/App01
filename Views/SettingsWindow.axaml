<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:models="using:App01.Models" 
        mc:Ignorable="d" d:DesignWidth="900" d:DesignHeight="600"
        x:Class="App01.Views.SettingsWindow"
        Title="Cấu Hình Hệ Thống"
        Width="900" Height="600"
        Background="#bcd7eb"
        x:CompileBindings="False"
        WindowStartupLocation="CenterScreen">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TabControl Grid.Row="0">
            
            <TabItem Header="🔧 MongoDB">
                <ScrollViewer>
                    <StackPanel Spacing="15" Margin="20">
                        <TextBlock Text="CẤU HÌNH MONGODB" FontWeight="Bold" FontSize="18"/>
                        
                        <StackPanel Spacing="10">
                            <TextBlock Text="Connection String:"/>
                            <TextBox Name="txtMongoConnection" 
                                     Watermark="mongodb://username:password@host:port/database"
                                     Height="60"
                                     TextWrapping="Wrap"/>
                        </StackPanel>

                        <StackPanel Spacing="10">
                            <TextBlock Text="Database Name:"/>
                            <TextBox Name="txtDatabaseName" Watermark="event"/>
                        </StackPanel>

                        <StackPanel Spacing="10">
                            <TextBlock Text="Resource Database Name (Cấu hình):"/>
                            <TextBox Name="txtResourceDbName" Watermark="MPARKING-..." ToolTip.Tip="Chứa tblGate, tblLane"/>
                        </StackPanel>

                        <StackPanel Spacing="10">
                            <TextBlock Text="Collection Name:"/>
                            <TextBox Name="txtCollectionName" IsReadOnly="True" Watermark="tblCardEventDay"/>
                        </StackPanel>

                        <Button Name="btnTestMongo" Content="🔌 Test Kết Nối" Width="150" HorizontalAlignment="Left" Click="BtnTestMongo_Click"/>
                        <TextBlock Name="txtMongoTestResult" Foreground="Gray" TextWrapping="Wrap"/>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="⚙️ Cài đặt chung">
    <StackPanel Spacing="15" Margin="20">
        <TextBlock Text="CÀI ĐẶT ỨNG DỤNG" 
                   FontWeight="Bold" 
                   FontSize="18"
                   Margin="0,0,0,10"/>
        
        <!-- Khởi động cùng Windows -->
        <Border BorderBrush="LightGray" 
                BorderThickness="1" 
                Padding="15"
                Background="White">
            <StackPanel Spacing="10">
                <CheckBox Name="ChkStartWithWindows"
                          Content="🚀 Tự động khởi động cùng Windows"
                          FontSize="14"
                          Checked="ChkStartWithWindows_Changed"
                          Unchecked="ChkStartWithWindows_Changed"/>
                
                <TextBlock Text="Khi bật, ứng dụng sẽ tự động chạy khi Windows khởi động"
                           Foreground="Gray"
                           FontSize="11"
                           Margin="30,0,0,0"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Border>
        
        <!-- Các cài đặt khác -->
        <Border BorderBrush="LightGray" 
                BorderThickness="1" 
                Padding="15"
                Background="White">
            <StackPanel Spacing="10">
                <TextBlock Text="📊 Hiển thị" FontWeight="Bold"/>
                
                <CheckBox Name="ChkMinimizeToTray"
                          Content="Thu nhỏ vào System Tray khi đóng"
                          IsEnabled="False"
                          ToolTip.Tip="Tính năng đang phát triển"/>
                
                <CheckBox Name="ChkShowNotifications"
                          Content="Hiển thị thông báo khi gần hết chỗ"
                          IsEnabled="False"
                          ToolTip.Tip="Tính năng đang phát triển"/>
            </StackPanel>
        </Border>
    </StackPanel>
</TabItem>


            <TabItem Header="🚪 Cổng &amp; Làn">
                <ScrollViewer>
                    <Grid RowDefinitions="Auto,Auto,*,Auto,Auto,Auto,*" Margin="10">

                        <!-- === PHẦN 1: QUẢN LÝ CỔNG === -->
                        <TextBlock Grid.Row="0" 
                                   Text="🚪 Quản lý Cổng (Gates)" 
                                   FontSize="16" FontWeight="Bold" 
                                   Margin="0,0,0,10"/>

                        <!-- Toolbar Cổng -->
                        <StackPanel Grid.Row="1" Margin="0,0,0,10">
                            <!-- Row 1: Load từ MongoDB -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <Button Name="BtnLoadGatesFromMongo" 
                                        Content="📥 Load Gates từ MongoDB" 
                                        Click="BtnLoadGatesFromMongo_Click"
                                        Background="DodgerBlue"
                                        Foreground="White"
                                        Margin="0,0,10,0"/>
                                <TextBlock Text="(Lấy danh sách cổng từ database)" 
                                           VerticalAlignment="Center"
                                           Foreground="Gray"
                                           FontSize="11"/>
                            </StackPanel>
                            
                            <!-- Row 2: Thêm thủ công -->
                            <StackPanel Orientation="Horizontal">
                                <ComboBox Name="CbAreaForGate" 
                                          Width="150" 
                                          PlaceholderText="Chọn khu vực"
                                          Margin="0,0,10,0"/>
                                <TextBox Name="TxtGateIdMongo" 
                                         Width="200" 
                                         Watermark="Gate ID (MongoDB)" 
                                         Margin="0,0,10,0"/>
                                <TextBox Name="TxtGateCode" 
                                         Width="80" 
                                         Watermark="Code" 
                                         Margin="0,0,10,0"/>
                                <TextBox Name="TxtGateName" 
                                         Width="120" 
                                         Watermark="Tên cổng" 
                                         Margin="0,0,10,0"/>
                                <Button Name="BtnAddGate" 
                                        Content="➕ Thêm" 
                                        Click="BtnAddGate_Click"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- DataGrid Cổng -->
                        <DataGrid Grid.Row="2" 
                                  Name="GatesDataGrid"
                                  Height="200"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="False"
                                  CanUserSortColumns="True"
                                  Margin="0,0,0,20">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="40" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Gate ID (Mongo)" Binding="{Binding GateIdMongo}" Width="150" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Code" Binding="{Binding GateCode}" Width="60"/>
                                <DataGridTextColumn Header="Tên cổng" Binding="{Binding GateName}" Width="*"/>
                                <DataGridTextColumn Header="Area ID" Binding="{Binding AreaId}" Width="60" IsReadOnly="True"/>
                                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="60"/>
                                <DataGridTemplateColumn Header="Thao tác" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <Button Content="💾" 
                                                        Click="BtnUpdateGate_Click" 
                                                        Tag="{Binding Id}"
                                                        ToolTip.Tip="Lưu"/>
                                                <Button Content="🗑️" 
                                                        Click="BtnDeleteGate_Click" 
                                                        Tag="{Binding Id}"
                                                        ToolTip.Tip="Xóa"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Separator -->
                        <Border Grid.Row="3" Height="2" Background="LightGray" Margin="0,10"/>

                        <!-- === PHẦN 2: QUẢN LÝ LÀN === -->
                        <TextBlock Grid.Row="4" 
                                   Text="🛣️ Quản lý Làn (Lanes)" 
                                   FontSize="16" FontWeight="Bold" 
                                   Margin="0,10,0,10"/>

                        <!-- Toolbar Làn -->
                        <StackPanel Grid.Row="5" Margin="0,0,0,10">
                            <!-- Row 1: Load từ MongoDB -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                <Button Name="BtnLoadLanesFromMongo" 
                                        Content="📥 Load Lanes từ MongoDB" 
                                        Click="BtnLoadLanesFromMongo_Click"
                                        Background="DodgerBlue"
                                        Foreground="White"
                                        Margin="0,0,10,0"/>
                                <TextBlock Text="(Lấy danh sách làn từ database)" 
                                           VerticalAlignment="Center"
                                           Foreground="Gray"
                                           FontSize="11"/>
                            </StackPanel>
                            
                            <!-- Row 2: Thêm thủ công -->
                            <StackPanel Orientation="Horizontal">
                                <ComboBox Name="CbGateForLane" 
                                          Width="150" 
                                          PlaceholderText="Chọn cổng"
                                          Margin="0,0,10,0"/>
                                <TextBox Name="TxtLaneIdMongo" 
                                         Width="200" 
                                         Watermark="Lane ID (MongoDB)" 
                                         Margin="0,0,10,0"/>
                                <TextBox Name="TxtLaneCode" 
                                         Width="60" 
                                         Watermark="Code" 
                                         Margin="0,0,10,0"/>
                                <TextBox Name="TxtLaneName" 
                                         Width="100" 
                                         Watermark="Tên làn" 
                                         Margin="0,0,10,0"/>
                                <Button Name="BtnAddLane" 
                                        Content="➕ Thêm" 
                                        Click="BtnAddLane_Click"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- DataGrid Làn -->
                        <DataGrid Grid.Row="6" 
                                  Name="LanesDataGrid"
                                  Height="200"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="40" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Lane ID (Mongo)" Binding="{Binding LaneIdMongo}" Width="150" IsReadOnly="True"/>
                                <DataGridTextColumn Header="Code" Binding="{Binding LaneCode}" Width="50"/>
                                <DataGridTextColumn Header="Tên làn" Binding="{Binding LaneName}" Width="*"/>
                                <DataGridTextColumn Header="Gate ID" Binding="{Binding GateId}" Width="60" IsReadOnly="True"/>
                                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="60"/>
                                <DataGridTemplateColumn Header="Thao tác" Width="120">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="5">
                                                <Button Content="💾" 
                                                        Click="BtnUpdateLane_Click" 
                                                        Tag="{Binding Id}"
                                                        ToolTip.Tip="Lưu"/>
                                                <Button Content="🗑️" 
                                                        Click="BtnDeleteLane_Click" 
                                                        Tag="{Binding Id}"
                                                        ToolTip.Tip="Xóa"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>

                    </Grid>
                </ScrollViewer>
            </TabItem>

            <TabItem Header="📍 Khu Vực">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="QUẢN LÝ KHU VỰC" FontWeight="Bold" FontSize="18" Margin="0,0,0,15"/>

                    <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Background="White" MinHeight="200">
                        <DataGrid Name="dgAreas"
                                  
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  GridLinesVisibility="All"
                                  CanUserResizeColumns="True"
                                  SelectionChanged="DgAreas_SelectionChanged">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                                <DataGridTextColumn Header="Tên Khu Vực" Binding="{Binding Name}" Width="200"/>
                                <DataGridTextColumn Header="Sức Chứa" Binding="{Binding MaxCapacity}" Width="100"/>
                                <DataGridTextColumn Header="Polling (s)" Binding="{Binding RefreshIntervalSeconds}" Width="100"/>
                                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="10" Margin="0,15,0,0">
                        <Button Name="btnAddArea" Content="➕ Thêm" Width="100" Click="BtnAddArea_Click"/>
                        <Button Name="btnEditArea" Content="✏️ Sửa" Width="100" IsEnabled="False" Click="BtnEditArea_Click"/>
                        <Button Name="btnDeleteArea" Content="🗑️ Xóa" Width="100" IsEnabled="False" Click="BtnDeleteArea_Click"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="💡 Bảng LED">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="QUẢN LÝ BẢNG LED" FontWeight="Bold" FontSize="18" Margin="0,0,0,15"/>

                    <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Background="White" MinHeight="200">
                        <DataGrid Name="dgLedBoards"
                                  
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  GridLinesVisibility="All"
                                  SelectionChanged="DgLedBoards_SelectionChanged">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                                <DataGridTextColumn Header="Tên" Binding="{Binding Name}" Width="150"/>
                                <DataGridTextColumn Header="IP Address" Binding="{Binding IpAddress}" Width="150"/>
                                <DataGridTextColumn Header="Port" Binding="{Binding Port}" Width="80"/>
                                <DataGridTextColumn Header="Area ID" Binding="{Binding AreaId}" Width="80"/>
                                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="10" Margin="0,15,0,0">
                        <Button Name="btnAddLed" Content="➕ Thêm" Width="100" Click="BtnAddLed_Click"/>
                        <Button Name="btnEditLed" Content="✏️ Sửa" Width="100" IsEnabled="False" Click="BtnEditLed_Click"/>
                        <Button Name="btnDeleteLed" Content="🗑️ Xóa" Width="100" IsEnabled="False" Click="BtnDeleteLed_Click"/>
                        <Button Name="btnTestLed" Content="🔌 Test" Width="100" IsEnabled="False" Click="BtnTestLed_Click"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="🎨 Kịch Bản">
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock Grid.Row="0" Text="QUẢN LÝ KỊCH BẢN HIỂN THỊ" FontWeight="Bold" FontSize="18" Margin="0,0,0,15"/>

                    <Border Grid.Row="1" BorderBrush="LightGray" BorderThickness="1" Background="White" MinHeight="200">
                        <DataGrid Name="dgTemplates"
                                  
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True"
                                  SelectionMode="Single"
                                  GridLinesVisibility="All"
                                  SelectionChanged="DgTemplates_SelectionChanged">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                                <DataGridTextColumn Header="Tên" Binding="{Binding Name}" Width="150"/>
                                <DataGridTextColumn Header="Dòng 1" Binding="{Binding Line1Format}" Width="200"/>
                                <DataGridTextColumn Header="Dòng 2" Binding="{Binding Line2Format}" Width="200"/>
                                <DataGridTextColumn Header="Font Size" Binding="{Binding FontSize}" Width="80"/>
                                <DataGridCheckBoxColumn Header="Active" Binding="{Binding IsActive}" Width="80"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Border>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="10" Margin="0,15,0,0">
                        <Button Name="btnAddTemplate" Content="➕ Thêm" Width="100" Click="BtnAddTemplate_Click"/>
                        <Button Name="btnEditTemplate" Content="✏️ Sửa" Width="100" IsEnabled="False" Click="BtnEditTemplate_Click"/>
                        <Button Name="btnDeleteTemplate" Content="🗑️ Xóa" Width="100" IsEnabled="False" Click="BtnDeleteTemplate_Click"/>
                    </StackPanel>
                </Grid>
            </TabItem>

        </TabControl>
        
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Spacing="10" Margin="0,15,0,0">
            <Button Name="btnSave" Content="💾 Lưu Cấu Hình" Width="150" Click="BtnSave_Click"/>
            <Button Name="btnClose" Content="Đóng" Width="100" Click="BtnClose_Click"/>
        </StackPanel>

    </Grid>
</Window>